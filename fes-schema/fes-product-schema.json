{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Metadata",
  "description": "Required metadata fields and terms determined by the USFWS Alaska Region FES program for Products.",
  "$id": "fes-product-schema.json",
  "version": "1.4.9",
  "type": "object",
  "properties": {
    "metadata": {
      "$ref": "#/definitions/Metadata"
    },
    "dataDictionary": {
      "$ref": "#/definitions/DataDictionary"
    }
  },
  "anyOf": [
    {
      "not": {
        "properties": {
          "metadata": {
            "properties": {
              "resourceInfo": {
                "properties": {
                  "resourceType": {
                    "const": "tabularDataset"
                  }
                }
              }
            }
          }
        }
      },
      "required": [
        "metadata",
        "dataDictionary"
      ]
    },
    {
      "required": [
        "metadata",
        "dataDictionary"
      ]
    }
  ],
  "definitions": {
    "Metadata": {
      "type": "object",
      "properties": {
        "metadataInfo": {
          "$ref": "#/definitions/MetadataInfo"
        },
        "resourceInfo": {
          "$ref": "#/definitions/ResourceInfo"
        },
        "resourceDistribution": {
          "$ref": "#/definitions/ResourceDistribution"
        },
        "associatedResource": {
          "$ref": "#/definitions/AssociatedResource"
        }
      },
      "required": [
        "metadataInfo",
        "resourceInfo",
        "resourceDistribution"
      ],
      "errorMessage": {
        "required": {
          "resourceDistribution": "Resource distribution must be described under the 'Distribution' tab."
        }
      },
      "title": "Metadata"
    },
    "MetadataInfo": {
      "type": "object",
      "properties": {
        "metadataDate": {
          "required": [
            "date",
            "dateType"
          ],
          "errorMessage": {
            "required": {
              "date": "At least one date associated with the metadata must be provided in the 'Basic Information' section under the 'Metadata' tab.",
              "dateType": "A date type must be provided for dates associated with the metadata in the 'Basic Information' section under the 'Metadata' tab."
            }
          }
        },
        "metadataContact": {
          "type": "array",
          "minItems": 2,
          "uniqueItems": true,
          "allOf": [
            {
              "contains": {
                "properties": {
                  "role": {
                    "const": "author"
                  }
                }
              }
            },
            {
              "contains": {
                "properties": {
                  "role": {
                    "const": "pointOfContact"
                  }
                }
              }
            }
          ],
          "required": [
            "role"
          ],
          "errorMessage": {
            "minItems": "At least two metadata contacts must be provided under the 'Metadata Contacts' section of the 'Metadata' tab. The first two metadata contacts must have the roles 'pointOfContact' and 'author'.",
            "uniqueItems": "Each role in the 'Metadata Contacts' section under the 'Metadata' tab must be unique."
          }
        }
      },
      "required": [
        "metadataDate",
        "metadataContact"
      ],
      "errorMessage": {
        "required": {
          "metadataDate": "At least one date associated with the metadata (such as creation or lastUpdate) must be provided in the 'Basic Information' section under the 'Metadata' tab.",
          "metadataContact": "At least one contact must be provided in the 'Metadata Contact' section under the 'Metadata' tab. At least one role must be 'pointOfContact'."
        }
      },
      "title": "MetadataInfo"
    },
    "ResourceInfo": {
      "type": "object",
      "properties": {
        "status": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "completed",
              "onGoing",
              "proposed",
              "accepted"
            ],
            "default": "onGoing",
            "errorMessage": {
              "enum": "Product status in the 'Basic Information' section under the 'Main' tab must be one of: 'completed', 'onGoing', 'proposed', or 'accepted'"
            }
          },
          "title": "Status"
        },
        "resourceType": {
          "type": "array",
          "items": {
            "properties": {
              "type": {
                "type": "string",
                "not": {
                  "enum": [
                    "product",
                    "project"
                  ]
                },
                "minLength": 1,
                "errorMessage": {
                  "not": "Resource type for products must not be 'product' or 'project' in the 'Resource Types' section under the 'Main' tab. Products should use a more specific type such as 'tabularDataset' or 'document'. For projects, use the custom profile for FES projects."
                }
              }
            }
        }
      },
        "pointOfContact": {
          "type": "array",
          "allOf": [
            {
              "contains": {
                "properties": {
                  "role": {
                    "const": "pointOfContact",
                    "errorMessage": {
                      "const": "The 'Point of Contact' section under the 'Main' tab must have at least one person listed as the role 'pointOfContact'."
                    }
                  }
                },
              }
            },
            {
              "contains": {
                "properties": {
                  "role": {
                    "const": "principalInvestigator",
                    "errorMessage": {
                      "const": "The 'Point of Contact' section under the 'Main' tab must have at least one person listed as the role 'principalInvestigator'."
                    }
                  }
                },
              }
            }
          ],
          "required": [
            "role",
            "party"
          ],
          "title": "PointOfContact",
          "errorMessage": {
            "role": "At least one role must be provided in the 'Point of Contact' section under the 'Main' tab.",
            "party": "At least one person must be assigned to a role in the 'Point of Contact' section under the 'Main' tab."
          }
        },
        "citation": {
          "type": "object",
          "properties": {
            "date": {
              "type": "array",
              "minItems": 1,
              "items": {
                "required": [
                  "date",
                  "dateType"
                ],
                "errorMessage": {
                  "required": {
                    "date": "At least one date (e.g. acquisition, creation, revision) must be provided in the 'Citation' section under the 'Main' tab.",
                    "dateType": "A type must be provided for dates in the 'Citation' section under the 'Main' tab."
                  }
                }
              }
            },
            "responsibleParty": {
              "type": "array",
              "allOf": [
                {
                  "contains": {
                    "properties": {
                      "role": {
                        "const": "pointOfContact",
                        "errorMessage": {
                          "const": "One role for 'Responsible Parties' within the 'Citation' section under the 'Main' tab must be pointOfContact."
                        }
                      }
                    }
                  }
                },
                {
                  "contains": {
                    "properties": {
                      "role": {
                        "const": "principalInvestigator",
                        "errorMessage": {
                          "const": "One role for 'Responsible Parties' within the 'Citation' section under the 'Main' tab must be principalInvestigator."
                        }
                      }
                    }
                  }
                }
              ]
            },
            "onlineResource": {
              "type": "array",
              "minItems": 1,
              "items": {
                "required": [
                  "uri",
                  "name",
                  "function"
                ],
                "errorMessage": {
                  "required": {
                    "uri": "A URI for the project homepage or Regional Data Repository folder must be provided in the 'Online Resource' section of the 'Citation' section under the 'Main' tab. This should be a link for browsing rather than a direct download link.",
                    "name": "A name for the project homepage or Regional Data Repository must be provided in the 'Online Resource' section of the 'Citation' section under the 'Main' tab.",
                    "function": "The function of the project homepage (i.e. browsing) must be provided in the 'Online Resource' section of the 'Citation' section under the 'Main' tab."
                  }
                }
              }
            },
            "identifier": {
              "type": "array",
              "contains": {
                "properties": {
                  "identifier": {},
                  "namespace": {
                    "const": "info:doi/",
                    "errorMessage": {
                      "const": "At least one identifier must be a Digital Object Identifier (DOI) in the 'Citation' section under the 'Main' tab."
                    }
                  }
                },
                "required": [
                  "identifier",
                  "namespace"
                ],
                "errorMessage": {
                  "required": {
                    "identifier": "Provide an identifier (e.g. Digital Object Identifier (DOI), ISBN, UUID) for the product in the 'Citation' section under the 'Main' tab.",
                    "namespace": "Provide the context (namespace) for the product identifier in the 'Citation' section under the 'Main' tab."
                  }
                }
              }
            }
          },
          "required": [
            "title",
            "date",
            "responsibleParty",
            "onlineResource",
            "identifier"
          ],
          "errorMessage": {
            "required": {
              "title": "A short, descriptive product title must be provided in the 'Basic Information' section under the 'Main' tab. Product titles should be uniquely identifiable.",
              "date": "At least one date (e.g. acquisition, creation, revision) must be provided in the 'Citation' section under the 'Main' tab.",
              "responsibleParty": "At least one Responsible Party must be provided in the 'Citation' section under the 'Main' tab. At least one pointOfContact and one principalInvestigator must be provided.",
              "onlineResource": "At least one online resource for the project (e.g. project homepage, project ServCat page, Regional Data Repository folder) must be provided within the 'Citation' section under the 'Main' tab.",
              "identifier": "At least one identifier must be provided within the 'Citation' section under the 'Main' tab. At least one identifier must be a Digital Object Identifier (DOI)."
            }
          },
          "title": "Citation"
        },
        "timePeriod": {
          "type": "object",
          "oneOf": [
            {
              "type": "object",
              "properties": {
                "startDateTime": {},
                "endDateTime": {}
              },
              "anyOf": [
                {
                  "required": [
                    "startDateTime"
                  ]
                },
                {
                  "required": [
                    "endDateTime"
                  ]
                }
              ]
            },
          ],
          "title": "TimePeriod"
        },
        "keyword": {
          "type": "array",
          "contains": {
            "properties": {
              "thesaurus": {
                "type": "object",
                "minItems": 1,
                "properties": {
                  "title": {
                    "const": "ISO 19115 Topic Category",
                    "errorMessage": {
                      "const": "At least one keyword under the 'Keywords' tab must be from the ISO Topic Category thesaurus."
                    }
                  }
                }
              }
            },
          },
          "required": [
            "thesaurus"
          ],
          "title": "Keywords"
        },
        "resourceMaintenance": {
          "type": "array",
          "items": {
            "required": [
              "frequency"
            ],
            "errorMessage": {
              "required": {
                "frequency": "Product resource maintenance frequency must be provided in the 'Maintenance' section under the 'Main' tab."
              }
            }
          }
        },
        "extent": {
          "type": "array",
          "items": {
            "properties": {
              "geographicExtent": {
                "items": {
                  "required": [
                    "description",
                    "boundingBox",
                    "geographicElement"
                  ],
                  "errorMessage": {
                    "required": {
                      "description": "A description of the geographic extent must be provided in the 'Geographic Extent' section under the 'Extent' tab.",
                      "boundingBox": "Bounding box coordinates for the geographic extent must be provided in the 'Geographic Extent' section under the 'Extent' tab.",
                      "geographicElement": "A map of geographic features must be provided in the 'Geographic Extent' section under the 'Extent' tab."
                    }
                  }
                }
              }
            }
          }
        },
        "constraint": {
          "type": "array",
          "items": {
            "properties": {
              "type": {},
              "legal": {
                "properties": {
                  "accessConstraint": {},
                  "useConstraint": {},
                  "otherConstraint": {}
                },
                "required": [
                  "accessConstraint",
                  "useConstraint",
                  "otherConstraint"
                ],
                "errorMessage": {
                  "required": {
                    "accessConstraint": "Data products are by default in the Public Domain and should have 'Access Constraint' set to 'licenseUnrestricted' in the 'Legal' section under the 'Constraints' tab.",
                    "useConstraint": "Data products are by default in the Public Domain and should have 'Use Constraint' set to 'unrestricted' in the 'Legal' section under the 'Constraint' tab.",
                    "otherConstraint": "Data products are by default in the Public Domain and should have the link to this license (https://creativecommons.org/publicdomain/zero/1.0/) in the 'Legal' section under the 'Constraint' tab. If another license applies to this data product, provide that link here."
                  }
                }
              }
            },
            "required": [
              "type",
              "legal"
            ],
            "errorMessage": {
              "required": {
                "type": "A constraint type for product use must be provided under the 'Constraints' tab. Government products by default fall under the U.S. Public Domain, and should have a constraint type of 'legal'.",
                "legal": "A description of the legal constraints for the product's use must be provided in the 'Legal' section under the 'Constraints' tab. Government products by default fall under the U.S. Public Domain, and should have 'Access Constraints' and 'Use Constraints' set to 'licenseUnrestricted' and 'unrestricted', respectively. A link to the public domain license should be provided in the 'Other Constraints' section."
              }
            }
          }
        }
      },
      "required": [
        "status",
        "resourceType",
        "pointOfContact",
        "citation",
        "abstract",
        "keyword",
        "resourceMaintenance",
        "constraint"
      ],
      "errorMessage": {
        "required": {
          "status": "The current product status must be provided in the 'Basic Information' section under the 'Main' tab. Status must be one of: 'completed', 'onGoing', 'proposed', or 'accepted'",
          "resourceType": "Resource type must be provided in the 'Resource Types' section under the 'Main' tab. The resource type for products must not be 'product', but should instead use a more specific type (e.g. tabularDataset, collection, document).",
          "pointOfContact": "Project and product specific personnel must be provided in the 'Point of Contact' section under the 'Main' tab.",
          "abstract": "An abstract for the product must be provided in the 'Description' section under the 'Main' tab. Abstracts should summarize the product's purpose and goals.",
          "keyword": "Product keywords must be provided under the 'Keywords' tab. At least one keyword must be provided from the 'ISO Topic Category' thesaurus.",
          "resourceMaintenance": "Resource maintenance frequency must be provided in the 'Maintenance' section under the 'Main' tab. The maintenance frequency should describe how often the product is reviewed and/or updated.",
          "constraint": "Resource constraints must be provided under the 'Constraints' tab. Government works are by default in the Public Domain, and should indicate this in the 'Legal' section."
        }
      },
      "title": "ResourceInfo"
    },
    "ResourceDistribution": {
      "type": "array",
      "items": {
        "properties": {
          "distributor": {
            "items": {
              "properties": {
                "contact": {
                  "type": "object",
                  "properties": {
                    "role": {
                      "const": "distributor",
                      "errorMessage": {
                        "const": "Role for distributor in the 'Distributor' section under the 'Distribution' tab must be 'distributor'."
                      }
                    }
                  }
                },
                "transferOption": {
                  "type": "array",
                  "items": {
                    "properties": {
                      "onlineOption": {
                        "type": "array",
                        "items": {
                          "required": [
                            "uri",
                            "name",
                            "function"
                          ],
                          "errorMessage": {
                            "required": {
                              "uri": "A URI must be provided for an online option to access the resource under the 'Transfer Option' section of the 'Distributor' section under the 'Distribution' tab. The URI should link to either the direct download (URI that will automatically start a download) or the link to page where you can download the resource.",
                              "name": "A specific name for the resource download must be provided for an online option to access the resource under the 'Transfer Option' section of the 'Distributor' section under the 'Distribution' tab.",
                              "function": "A link function must be provided for an online option to access the resource under the 'Transfer Option' section of the 'Distributor' section under the 'Distribution' tab. The function should be either 'download' if it is a direct download link or 'fileAccess' if it is a link to a page where data can be downloaded."
                            }
                          }
                        }
                      }
                    },
                    "required": [
                      "onlineOption"
                    ],
                    "errorMessage": {
                      "required": {
                        "onlineOption": "An online option for distribution must be provided in the 'Transfer Option' section of the 'Distributor' section under the 'Distribution' tab."
                      }
                    }
                  }
                }
              },
              "required": [
                "contact",
                "transferOption"
              ],
              "errorMessage": {
                "required": {
                  "contact": "Provide a contact for distribution in the 'Distributor' section under the 'Distribution' tab.",
                  "transferOption": "A transfer option must be provided for distribution in the 'Distributor' section under the 'Distribution' tab."
                }
              }
            }
          }
        },
        "required": [
          "distributor"
        ],
        "errorMessage": {
          "required": {
            "distributor": "Provide a distributor."
          }
        }
      },
      "title": "ResourceDistribution"
    },
    "AssociatedResource": {
      "type": "array",
      "contains": {
        "properties": {
          "associationType": {
            "const": "parentProject",
            "errorMessage": {
              "const": "At least one association type must be parentProject under the 'Associations' tab."
            }
          }
        },
        "required": [
          "associationType"
        ],
        "errorMessage": {
          "required": {
            "associationType": "Products with associations must have an association type listed under the 'Associations' tab."
          }
        }
      },
      "title": "AssociatedResource"
    },
    "DataDictionary": {
      "type": "array",
      "title": "DataDictionary"
    }
  }
}
